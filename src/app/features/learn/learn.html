<div class="p-4 max-w-lg mx-auto flex flex-col gap-6">
  
  <!-- Header -->
  <div class="flex items-center gap-4 py-2">
    <button (click)="goBack()" aria-label="Go back to home page" class="btn btn-circle btn-ghost btn-sm">
      <lucide-angular [img]="BackIcon" class="w-6 h-6 text-neutral"></lucide-angular>
    </button>
    <h1 class="gradient-text-primary text-3xl font-heading font-black tracking-tight">
        @if (store.isListenMode()) { {{ 'learn.mode_listen' | translate }} }
        @else { {{ 'learn.mode_practice' | translate }} }
    </h1>
  </div>

  <!-- Tab Switcher -->
  <div role="tablist" class="grid grid-cols-2 bg-base-200 p-2 rounded-[2rem] shadow-inner mb-2" aria-label="Learning mode selection">
    <button 
      role="tab"
      [attr.aria-selected]="store.isListenMode()"
      [attr.aria-controls]="'listen-panel'"
      class="btn btn-lg rounded-full"
      [class.btn-secondary]="store.isListenMode()"
      [class.btn-ghost]="!store.isListenMode()"
      (click)="onTabChange('listen')"
    >
      <lucide-angular [img]="VolumeIcon" class="w-6 h-6"></lucide-angular>
      {{ 'learn.tab_listen' | translate }}
    </button>
    <button 
      role="tab"
      [attr.aria-selected]="store.isPracticeMode()"
      [attr.aria-controls]="'practice-panel'"
      class="btn btn-lg rounded-full"
      [class.btn-primary]="store.isPracticeMode()"
      [class.btn-ghost]="!store.isPracticeMode()"
      (click)="onTabChange('practice')"
    >
      <lucide-angular [img]="MicIcon" class="w-6 h-6"></lucide-angular>
      {{ 'learn.tab_practice' | translate }}
    </button>
  </div>

  <!-- Content Card -->
  <app-text-display 
    [text]="store.text()" 
    [currentWordIndex]="store.currentWordIndex()"
    [mispronuncedWords]="store.mispronuncedWords()"
    (wordClick)="onWordClick($event)"
  ></app-text-display>

  <!-- Controls -->
  @if (store.isListenMode()) {
    <div id="listen-panel" role="tabpanel" aria-labelledby="listen-tab">
      <app-player-controls
        [isPlaying]="store.isPlaying()"
        [playbackSpeed]="store.playbackSpeed()"
        [currentWordIndex]="store.currentWordIndex()"
        [totalWords]="totalWords"
        (playToggle)="togglePlay()"
        (reset)="resetAudio()"
        (speedChange)="onSpeedChange($event)"
        (positionChange)="onPositionChange($event)"
      ></app-player-controls>
    </div>
  } @else {
    <div id="practice-panel" role="tabpanel" aria-labelledby="practice-tab">
      <app-practice-controls
        [isRecording]="store.isRecording()"
        (toggleRecording)="toggleRecording()"
      ></app-practice-controls>
    </div>
  }

  <!-- Word Detail Modal -->
  <app-word-modal 
    [word]="selectedWord" 
    [languageCode]="store.languageCode()"
    [definition]="store.selectedWordDefinition()"
    [imageUrl]="store.selectedWordImage()"
    [isLoading]="store.isWordLoading()"
  ></app-word-modal>

  <!-- Pronunciation Feedback Modal -->
  @if (store.pronunciationScore() !== null) {
    <app-feedback-modal
        [score]="store.pronunciationScore()!"
        [feedback]="store.pronunciationFeedback()!"
        [isOpen]="true"
        (close)="closeFeedback()"
    ></app-feedback-modal>
  }

</div>
